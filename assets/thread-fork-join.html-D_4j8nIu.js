import{_ as n,c as s,o as a,b as e}from"./app-DSsDsDSZ.js";const p="/TIL/images/java/20241003-fork-join-1.png",t="/TIL/images/java/20241003-fork-join-2.png",l={},o=e('<h1 id="fork-join-recursivetask" tabindex="-1"><a class="header-anchor" href="#fork-join-recursivetask"><span>Fork, Join, RecursiveTask</span></a></h1><p>하나의 작업을 여러 개의 작은 작업으로 나누어 (<code>fork</code>) 계산하고, 작업한 결과를 병합하는 (<code>join</code>) 것을 말한다.</p><p><img src="'+p+`" alt="fork-join"><em>출처 : https://www.geeksforgeeks.org/forkjoinpool-class-in-java-with-examples/</em></p><h2 id="forkjoinpool" tabindex="-1"><a class="header-anchor" href="#forkjoinpool"><span>ForkJoinPool</span></a></h2><p>효율적인 병렬 처리를 위해서 Java 7에 도입되었다. 분할 정복 알고리즘을 통해 재귀적으로 처리하는 작업에 최적화된 Work Stealing 알고리즘을 사용하는 스레드 풀이다.</p><p>ForkJoinPool을 사용하면 큰 작업을 작은 단위로 분할한 후 이를 병렬로 처리할 수 있다.</p><p>상속 구조는 다음과 같다.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">java.lang.Object</span>
<span class="line">	java.util.concurrent.AbstractExecutorService</span>
<span class="line">		java.util.concurrent.ForkJoinPool</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="work-stealing" tabindex="-1"><a class="header-anchor" href="#work-stealing"><span>Work Stealing</span></a></h3><p><img src="`+t+`" alt="work-stealing"><em>출처 : http://www.h-online.com/developer/features/The-fork-join-framework-in-Java-7-1762357.html</em></p><p>작업을 분할하면 모든 CPU 코어에서 실행할 것이고 크기가 같은 각각의 작업은 같은 시간 안에 종료될 것이라 생각할 수 있다.</p><p>하지만 서브 작업의 완료시간은 크게 달라질 수 있다. 분할 기법이 효율적이지 않기 때문일 수 있고, 예기치 않게 디스크 접근 속도가 저하되거나 외부 서비스와 협력하는 과정에서 지연이 생길 수 있기 때문이다.</p><p>Fork/Join 프레임워크에서는 Work Stealing, 작업 훔치기 기법으로 이 문제를 해결한다. 작업 훔치기 기법에서는 ForkJoinPool의 모든 스레드를 거의 공정하게 분할한다. 각각의 스레드는 자신에게 할당된 작업을 포함한 이중 연결 리스트를 참조하면서 작업이 끝날 때마다 큐의 헤드에서 다른 작업을 가져와서 작업을 처리한다. 이때 한 스레드는 다른 스레드보다 자신에게 할당된 작업을 더 빨리 처리할 수 있다.</p><p>즉, 할 일이 없어진 스레드가 다른 스레드의 큐에서 대기하고 있는 작업을 가져가서 대신 해주는 것이다. 따라서 작업 스레드 간의 작업 부하를 비슷한 수준으로 유지할 수 있다.</p><h2 id="recursiveaction-recursivetask" tabindex="-1"><a class="header-anchor" href="#recursiveaction-recursivetask"><span>RecursiveAction, RecursiveTask</span></a></h2><p>ForkJoinPool을 이용하려면 ForkJoinTask를 확장한 클래스를 사용해야 한다. ForkJoinTask를 확장한 추상 클래스는 RecursiveAction, RecursiveTask&lt;T&gt; 이 있으며 이 클래스의 서브 클래스를 만들어서 사용한다.</p><p>RecursiveAction과 RecursiveTask&lt;T&gt;의 차이는 처리 결과 값 리턴 여부이다. RecursiveTask&lt;T&gt;은 결과 값을 리턴하며 RecursiveAction은 결과 값을 리턴하지 않는다.</p><p>두 클래스의 확장 관계는 다음과 같다.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">java.lang.Object</span>
<span class="line">    java.util.concurrent.ForkJoinTask&lt;Void&gt;</span>
<span class="line">        java.util.concurrent.RecursiveAction</span>
<span class="line">            implemented Serializable, Future&lt;Void&gt;</span>
<span class="line">    </span>
<span class="line">java.lang.Object</span>
<span class="line">    java.util.concurrent.ForkJoinTask&lt;V&gt;</span>
<span class="line">        java.util.concurrent.RecursiveTask&lt;V&gt;</span>
<span class="line">            implemented Serializable, Future&lt;Void&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>두 클래스는 <code>compute()</code> 추상 메서드를 가지며 서브 클래스를 만들 때 <code>compute()</code> 메소드를 구현해야 한다.</p><p><code>compute()</code> 메서드는 작업을 서브 작업으로 분할하는 로직과 더 이상 분할할 수 없을 때 개별 서브 작업의 처리 결과를 생산할 알고리즘을 정의한다. 대부분의 작업 수행은 다음과 같다.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>작업 단위가 충분히 작거나 더 이상 분할할 수 없으면<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    해당 작업을 수행</span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    작업을 쪼개어 두 개의 작업으로 분할<span class="token punctuation">(</span>재귀적 호출<span class="token punctuation">,</span> fork<span class="token punctuation">)</span></span>
<span class="line">    모든 서브태스크의 연산이 완료될 때까지 기다림</span>
<span class="line">    각 서브태스크의 결과를 합칩<span class="token punctuation">(</span>join<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="예제-코드" tabindex="-1"><a class="header-anchor" href="#예제-코드"><span>예제 코드</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetSum</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">long</span> from<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">GetSum</span><span class="token punctuation">(</span><span class="token keyword">long</span> from<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token keyword">to</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>from <span class="token operator">=</span> from<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">to</span> <span class="token operator">=</span> <span class="token keyword">to</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token class-name">Long</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">long</span> gap <span class="token operator">=</span> <span class="token keyword">to</span> <span class="token operator">-</span> from<span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 작업 단위가 충분히 작을 경우 -&gt; 해당 작업 수행</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>gap <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">long</span> tempSum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> loop <span class="token operator">=</span> from<span class="token punctuation">;</span> loop <span class="token operator">&lt;=</span> <span class="token keyword">to</span><span class="token punctuation">;</span> loop<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                tempSum <span class="token operator">+=</span> loop<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token keyword">return</span> tempSum<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">// 작업을 나누기 위해서 중간값 찾기</span></span>
<span class="line">        <span class="token keyword">long</span> middle <span class="token operator">=</span> <span class="token punctuation">(</span>from <span class="token operator">+</span> <span class="token keyword">to</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 중간값을 이용하여 작업 수행을 위한 두 개의 객체 생성</span></span>
<span class="line">        <span class="token class-name">GetSum</span> sumPre <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetSum</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> middle<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 작업 하나를 수행하고</span></span>
<span class="line">        sumPre<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 두 번째 객체 생성</span></span>
<span class="line">        <span class="token class-name">GetSum</span> sumPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetSum</span><span class="token punctuation">(</span>middle <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 또 다른 작업을 수행한 후(sumPost.compute()) -&gt; sumPre에서 시작한 작업을 기다린다.</span></span>
<span class="line">        <span class="token keyword">return</span> sumPost<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> sumPre<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>fork()</code> 메서드는 해당 작업을 스레드 풀의 작업 큐에 넣는 비동기 메서드이다.</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForkJoinSample</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ForkJoinPool</span> mainPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ForkJoinSample</span> sample <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinSample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        sample<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">long</span> from <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">long</span> <span class="token keyword">to</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">GetSum</span> sum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetSum</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Long</span> result <span class="token operator">=</span> mainPool<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Fork Join: Total sum of &quot;</span> <span class="token operator">+</span> from <span class="token operator">+</span> <span class="token string">&quot; ~ &quot;</span> <span class="token operator">+</span> <span class="token keyword">to</span> <span class="token operator">+</span> <span class="token string">&quot; = &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="references" tabindex="-1"><a class="header-anchor" href="#references"><span>References</span></a></h2><ul><li>Java의 신</li><li>모던 자바 인 액션</li></ul>`,28),c=[o];function i(r,u){return a(),s("div",null,c)}const d=n(l,[["render",i],["__file","thread-fork-join.html.vue"]]),v=JSON.parse('{"path":"/java/thread-fork-join.html","title":"Fork, Join, RecursiveTask","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"ForkJoinPool","slug":"forkjoinpool","link":"#forkjoinpool","children":[{"level":3,"title":"Work Stealing","slug":"work-stealing","link":"#work-stealing","children":[]}]},{"level":2,"title":"RecursiveAction, RecursiveTask","slug":"recursiveaction-recursivetask","link":"#recursiveaction-recursivetask","children":[{"level":3,"title":"예제 코드","slug":"예제-코드","link":"#예제-코드","children":[]}]},{"level":2,"title":"References","slug":"references","link":"#references","children":[]}],"git":{"updatedTime":1727949456000,"contributors":[{"name":"depark","email":"mem29238@gmail.com","commits":1}]},"filePathRelative":"java/thread-fork-join.md"}');export{d as comp,v as data};
